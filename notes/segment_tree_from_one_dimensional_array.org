:PROPERTIES:
:ID:       252C5055-2C0D-4B0E-A4BF-9507B85A179F
:END:
#+TITLE: Segment Tree

* TODO Write explanation

#+begin_src python
  class SegTree:
      def __init__(self, n, op):
          self.n = n
          self.op = op
          self.tree = [None] * (4 * n)

      def update(self, pos, val):
          def rec(i, l, r):
              if l == r:
                  self.tree[i] = val
                  return

              m = (l + r) // 2
              if pos <= m:
                  rec(i * 2, l, m)
              else:
                  rec(i * 2 + 1, m + 1, r)

              self.tree[i] = self._op(self.tree[i * 2], self.tree[i * 2 + 1])

          rec(1, 0, self.n)
          return self.tree[1]

      def query(self, ql, qr):
          def rec(i, l, r):
              intersect = l <= ql <= r or l <= qr <= r
              if l > r or not intersect:
                  return None
              if ql <= l <= r <= qr:
                  return self.tree[i]
              m = (l + r) // 2
              return self._op(rec(i * 2, l, m), rec(i * 2 + 1, m + 1, r))

          return rec(1, 0, self.n)

      def _op(self, a, b):
          if a is not None and b is not None:
              return self.op(a, b)
          if a is not None:
              return a
          return b


  st1 = SegTree(3, lambda a, b: a + b)
  assert st1.update(3, 1) == 1
  assert st1.query(0, 3) == 1
  assert st1.update(1, 2) == 3
  assert st1.query(0, 2) == 2
  assert st1.update(0, 1) == 4
  assert st1.query(0, 3) == 4
  assert st1.query(0, 0) == 1


  st2 = SegTree(3, min)
  assert st2.update(3, 2) == 2
  assert st2.query(3, 3) == 2
  assert st2.update(0, 3) == 2
  assert st2.query(0, 2) == 3
  assert st2.update(1, 1) == 1
  assert st2.query(0, 2) == 1
#+end_src
