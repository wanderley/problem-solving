<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Contest de seleccion IOI 2022: B. Interseccion Interna</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" href="style.css">
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<!--  --><nav><span class="nav-header">Problem Solving</span><span class="nav-items"><a href="index.html">Home</a><span></nav><div id="content" class="content">
<h1 class="title">Contest de seleccion IOI 2022: B. Interseccion Interna</h1>
<p>
<a href="https://contest.yandex.ru/contest/38353/download/">Problem Statement</a>: Given \(m\) segments between \(n\) points in a circle, determine how many segments intersect.
</p>

<p>
There are at least two ways to think about this problem: open/close parentheses and intervals.  In both representations, we can see that we would like to count the number of open parentheses or intervals (i.e. open events) when we are faced with a close parentheses or intervals.  For interval, this problem is known as <a href="fenwicktree.html#ID-45BF6518-3BF3-4BBC-80B2-8AEF4F386E41">Problem: Count number of interval intersections</a>.  From the problem constraints, it is clear that we need something better than linear time.
</p>


<div id="org0a07a53" class="figure">
<p><img src="./assets/RB 2022-06-16 10.54.43 1.jpg" alt="RB 2022-06-16 10.54.43 1.jpg" />
</p>
</div>

<p>
Let's use the interval representation for now on.  Suppose that we are processing all events from left to right: open \((1, 3)\), open \((1, 5)\), open \((2, 4)\), open \((2, 5)\), close \((1, 3)\), &#x2026;
</p>

<p>
Be \(c\) an array where \(c[i]\) is the number of open events minus the number of close events that happened on the \(i\)th position.  The sum of \(c[1]+c[2]+..+c[i]\) represents the number of open intervals that start on \(1..i\) but closes on \(i..n\).  For each event, we can update \(c\) as following: (1) an open event \((l, r)\) adds one to \(c[l]\) and subtracts one from \(c[r]\), and (2) an close event \((l, r)\) subtracts one from \(c[l]\) and adds one to \(c[r]\).  To check the number of intersection on a close event \((l, r)\), we can compute \(c[l]+c[l+1]+..+c[r]\).  We can use a <a href="fenwicktree.html#ID-2B44007C-8EC7-49DA-9A9B-0D6CF6578083">FenwickTree</a> to implement \(c\) and do the operations add and sum in logarithmic time.  The following code implements this idea.
</p>

<ul class="org-ul">
<li>Time complexity: \(O(n\lg n)\).</li>
<li>Space complexity: \(O(n)\).</li>
</ul>

<div class="org-src-container">
<pre class="src src-C++"><span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;algorithm&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;iostream&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;set&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;string.h&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;vector&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;stack&gt;</span>
<span style="font-weight: bold;">#include</span> <span style="font-style: italic;">&lt;assert.h&gt;</span>

<span style="font-weight: bold;">using</span> <span style="font-weight: bold;">namespace</span> <span style="font-weight: bold; text-decoration: underline;">std</span>;

<span style="font-weight: bold;">#define</span> <span style="font-weight: bold; font-style: italic;">ll</span> <span style="font-weight: bold; text-decoration: underline;">long</span> <span style="font-weight: bold; text-decoration: underline;">long</span>

<span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">source: https://cp-algorithms.com/data_structures/fenwick.html#finding-sum-in-one-dimensional-array</span>
<span style="font-weight: bold;">struct</span> <span style="font-weight: bold; text-decoration: underline;">FenwickTree</span> {
    <span style="font-weight: bold; text-decoration: underline;">vector</span>&lt;ll&gt; <span style="font-weight: bold; font-style: italic;">bit</span>;  <span style="font-weight: bold; font-style: italic;">// </span><span style="font-weight: bold; font-style: italic;">binary indexed tree</span>
    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">n</span>;

    <span style="font-weight: bold;">FenwickTree</span>(<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">n</span>) {
        <span style="font-weight: bold;">this</span>-&gt;n = n;
        bit.assign(n, 0);
    }

    <span style="font-weight: bold;">FenwickTree</span>(<span style="font-weight: bold; text-decoration: underline;">vector</span>&lt;ll&gt; <span style="font-weight: bold; font-style: italic;">a</span>) : FenwickTree(a.size()) {
        <span style="font-weight: bold;">for</span> (<span style="font-weight: bold; text-decoration: underline;">size_t</span> <span style="font-weight: bold; font-style: italic;">i</span> = 0; i &lt; a.size(); i++)
            add(i, <span style="font-weight: bold; text-decoration: underline;">a</span>[i]);
    }

    <span style="font-weight: bold; text-decoration: underline;">ll</span> <span style="font-weight: bold;">sum</span>(<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">r</span>) {
        <span style="font-weight: bold; text-decoration: underline;">ll</span> <span style="font-weight: bold; font-style: italic;">ret</span> = 0;
        <span style="font-weight: bold;">for</span> (; r &gt;= 0; r = (r &amp; (r + 1)) - 1)
            ret += bit[r];
        <span style="font-weight: bold;">return</span> ret;
    }

    <span style="font-weight: bold; text-decoration: underline;">ll</span> <span style="font-weight: bold;">sum</span>(<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">l</span>, <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">r</span>) {
        <span style="font-weight: bold;">return</span> sum(r) - sum(l - 1);
    }

    <span style="font-weight: bold; text-decoration: underline;">void</span> <span style="font-weight: bold;">add</span>(<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">idx</span>, <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">delta</span>) {
        <span style="font-weight: bold;">for</span> (; idx &lt; n; idx = idx | (idx + 1))
            bit[idx] += delta;
    }
};

<span style="font-weight: bold; text-decoration: underline;">ll</span> <span style="font-weight: bold;">solve</span>(<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">n</span>, <span style="font-weight: bold; text-decoration: underline;">vector</span>&lt;<span style="font-weight: bold; text-decoration: underline;">pair</span>&lt;<span style="font-weight: bold; text-decoration: underline;">int</span>, <span style="font-weight: bold; text-decoration: underline;">int</span>&gt;&gt; <span style="font-weight: bold; font-style: italic;">points</span>) {
  <span style="font-weight: bold; text-decoration: underline;">FenwickTree</span> <span style="font-weight: bold; font-style: italic;">ft</span> = FenwickTree(n + 1);
  <span style="font-weight: bold; text-decoration: underline;">ll</span> <span style="font-weight: bold; font-style: italic;">ans</span> = 0;
  <span style="font-weight: bold;">for</span> (<span style="font-weight: bold; text-decoration: underline;">vector</span>&lt;<span style="font-weight: bold; text-decoration: underline;">pair</span>&lt;<span style="font-weight: bold; text-decoration: underline;">int</span>, <span style="font-weight: bold; text-decoration: underline;">int</span>&gt;&gt;::<span style="font-weight: bold; text-decoration: underline;">iterator</span> <span style="font-weight: bold; font-style: italic;">it</span> = points.begin(); it != points.end(); it++) {
    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">l</span> = it-&gt;first;
    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">r</span> = it-&gt;second;
    <span style="font-weight: bold;">if</span> (l &lt; r) {
      ft.add(l, +1);
      ft.add(r, -1);
    } <span style="font-weight: bold;">else</span> {
      ft.add(r, -1);
      ft.add(l, +1);
      ans += ft.sum(r + 1, l);
    }
  }
  <span style="font-weight: bold;">return</span> ans;
}

<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold;">main</span>() {
  <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">n</span>, <span style="font-weight: bold; font-style: italic;">m</span>;
  <span style="font-weight: bold; text-decoration: underline;">vector</span>&lt;<span style="font-weight: bold; text-decoration: underline;">pair</span>&lt;<span style="font-weight: bold; text-decoration: underline;">int</span>, <span style="font-weight: bold; text-decoration: underline;">int</span>&gt;&gt; <span style="font-weight: bold; font-style: italic;">points</span>;
  cin &gt;&gt; n &gt;&gt; m;
  <span style="font-weight: bold;">for</span> (<span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">i</span> = 0; i &lt; m; i++) {
    <span style="font-weight: bold; text-decoration: underline;">int</span> <span style="font-weight: bold; font-style: italic;">l</span>, <span style="font-weight: bold; font-style: italic;">r</span>;
    cin &gt;&gt; l &gt;&gt; r;
    points.push_back(make_pair(l, r));
    points.push_back(make_pair(r, l));
  }
  sort(points.begin(), points.end());
  cout &lt;&lt; solve(n, points) &lt;&lt; endl;
  <span style="font-weight: bold;">return</span> 0;
}
</pre>
</div>
</div>
</body>
</html>